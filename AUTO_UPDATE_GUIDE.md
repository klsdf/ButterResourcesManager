# Electron 自动更新功能使用指南

## 功能概述

本项目已集成完整的自动更新功能，包括：

1. **自动检查更新** - 应用启动时自动检查新版本
2. **手动检查更新** - 用户可在设置页面手动检查更新
3. **自动下载更新** - 可选择自动下载更新包
4. **更新通知** - 通过系统托盘和对话框通知用户
5. **进度显示** - 显示下载进度和状态

## 配置说明

### 1. package.json 配置

```json
{
  "build": {
    "publish": {
      "provider": "github",
      "owner": "your-github-username",
      "repo": "butter-manager-vue"
    }
  }
}
```

**重要**: 请将 `your-github-username` 替换为你的实际 GitHub 用户名。

### 2. GitHub 发布配置

1. 在 GitHub 仓库中创建 Release
2. 上传构建好的安装包文件
3. 系统会自动检测新版本

## 使用方法

### 开发环境测试

1. 构建应用：
```bash
npm run electron-build
```

2. 发布到 GitHub：
```bash
npm run dist -- --publish=always
```

### 生产环境

1. 应用启动时会自动检查更新
2. 发现新版本时会显示通知
3. 用户可在设置页面的"更新"分类中管理更新

## 功能特性

### 自动更新设置

- **自动检查更新**: 应用启动时自动检查
- **自动下载更新**: 发现新版本时自动下载
- **更新检查间隔**: 每小时检查一次

### 用户界面

- **当前版本显示**: 显示应用当前版本号
- **更新状态**: 实时显示更新检查状态
- **下载进度**: 显示更新下载进度
- **操作按钮**: 提供检查、下载、安装按钮

### 通知系统

- **系统托盘通知**: 发现新版本时显示托盘通知
- **对话框提示**: 更新下载完成后显示安装提示
- **状态反馈**: 实时反馈更新状态和错误信息

## 文件结构

```
public/
├── electron.js          # 主进程，包含自动更新逻辑
├── preload.js           # 预加载脚本，暴露更新API
└── ...

src/pages/
└── SettingsView.vue     # 设置页面，包含更新管理界面
```

## API 接口

### 主进程 (electron.js)

- `initAutoUpdater()` - 初始化自动更新
- `checkForUpdates()` - 检查更新
- `downloadUpdate()` - 下载更新
- `quitAndInstall()` - 安装更新

### 渲染进程 (preload.js)

- `checkForUpdates()` - 手动检查更新
- `downloadAndInstallUpdate()` - 下载并安装更新
- `quitAndInstall()` - 立即重启并安装

### 事件监听

- `update-checking` - 正在检查更新
- `update-available` - 发现新版本
- `update-not-available` - 当前已是最新版本
- `update-download-progress` - 下载进度
- `update-downloaded` - 下载完成
- `update-error` - 更新错误

## 注意事项

1. **开发环境**: 自动更新功能仅在打包后的应用中生效
2. **网络要求**: 需要网络连接来检查更新
3. **权限要求**: 安装更新可能需要管理员权限
4. **GitHub 配置**: 确保 GitHub 仓库配置正确

## 故障排除

### 常见问题

1. **更新检查失败**
   - 检查网络连接
   - 确认 GitHub 仓库配置正确
   - 查看控制台错误信息

2. **下载失败**
   - 检查网络连接
   - 确认 GitHub Release 文件可访问
   - 检查磁盘空间

3. **安装失败**
   - 确认有管理员权限
   - 关闭其他相关进程
   - 检查防病毒软件设置

### 调试方法

1. 查看控制台日志
2. 检查网络请求
3. 验证 GitHub Release 配置
4. 测试手动更新流程

## 更新流程

1. **检查更新** → 2. **发现新版本** → 3. **下载更新** → 4. **安装更新** → 5. **重启应用**

每个步骤都有相应的用户界面反馈和错误处理机制。
